"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const r="---young-rpc-shake-hands-message-request---";class i{constructor(){this.handlersMap={},window.opener&&window.opener!==window?this.masterWindow=window.opener:window.parent&&window.parent!==window&&(this.masterWindow=window.parent),this.shakeHands()}shakeHands(){if(!this.masterWindow)throw new Error("YoungRPCSlave can only be used in sub window");const n=new MessageChannel;this.port=n.port1,this.port.onmessage=s=>{const{data:e,isTrusted:t}=s;t&&e&&(e.cmd&&typeof e.cmd=="string"&&this.handlersMap[e.cmd]?this.handlersMap[e.cmd](e):console.warn("\u{1F680}unknown msg",e))},this.port.onmessageerror=s=>{console.error("\u{1F680} ~ YoungRPCSlave ~ e",s)},this.masterWindow.postMessage(r,"*",[n.port2])}trigger(n,s={}){this.port.postMessage({cmd:n,params:s})}setHandler(n,{success:s,fail:e}){return this.handlersMap[n]=async({ok:t,data:o})=>{t?await(s==null?void 0:s(o)):await(e==null?void 0:e(o))},this.trigger.bind(this,n)}}class d{constructor(){this.handlersMap={},window.addEventListener("message",async n=>{n.data===r&&(this.port=n.ports[0],this.port.onmessage=s=>{const{data:e,isTrusted:t}=s;t&&e&&(e.cmd&&typeof e.cmd=="string"&&this.handlersMap[e.cmd]?this.handlersMap[e.cmd](e.params):console.warn("\u{1F680}unknown msg",e))},this.port.onmessageerror=s=>{console.error("\u{1F680} ~ YoungRPCMaster ~ ",s)},console.log("\u{1F680}\u{1F680}\u{1F680} master app is ready \u{1F680}\u{1F680}\u{1F680}"))})}setHandler(n,s){this.handlersMap[n]=s}close(){this.port.close()}sendMsg(n){this.port.postMessage(n)}}exports.YoungRPCMaster=d;exports.YoungRPCSlave=i;
//# sourceMappingURL=index.cjs.js.map
