{"version":3,"file":"index.umd.js","sources":["../src/index.ts"],"sourcesContent":["/*\n * @Author: zhangyang\n * @Date: 2022-07-02 14:36:13\n * @LastEditTime: 2022-08-04 15:53:07\n * @Description: \n */\ntype AuthConfig = {\n  /**\n   * 微信公众号 appid\n   */\n  appid: string;\n  /**\n   * state 标志位的内容\n   * @default 'young_wechat_auth'\n   */\n  state?: string;\n  /**\n   * 重定向的地址\n   * @default location.href\n   */\n  redirect?: string;\n};\n\nconst defaultConfig: Omit<Required<AuthConfig>, 'appid'> = {\n  state: 'young_wechat_auth',\n  redirect: location.href\n};\n\nexport default class {\n  public auth_url: string;\n  public login_url: string;\n\n  constructor(conf: AuthConfig) {\n    conf = Object.assign(defaultConfig, conf);\n    this.auth_url = `https://open.weixin.qq.com/connect/oauth2/authorize?appid=${conf.appid}&redirect_uri=${encodeURIComponent(conf.redirect)}&response_type=code&scope=snsapi_base&state=${conf.state}#wechat_redirect`;\n    \n    const isWeChat = /MicroMessenger/img.test(navigator.userAgent);\n    if (isWeChat) {\n      // 微信内，执行网页授权\n      this.login_url = `https://open.weixin.qq.com/connect/oauth2/authorize?appid=${conf.appid}&redirect_uri=${encodeURIComponent(conf.redirect)}&response_type=code&scope=snsapi_userinfo&state=${conf.state}#wechat_redirect`;\n    } else {\n      // 微信外，扫码登录\n      this.login_url = `https://open.weixin.qq.com/connect/qrconnect?appid=${conf.appid}&redirect_uri=${encodeURIComponent(conf.redirect)}&response_type=code&scope=snsapi_login&state=${conf.state}#wechat_redirect`;\n    }\n  }\n  \n  getCode(type: 'base' | 'login' = 'base') {\n    const args = new URLSearchParams(location.search);\n    const code = args.get('code');\n    const state = args.get('state');\n    if (state) {\n      return code;\n    } else {\n      if (type === 'base') {\n        location.href = this.auth_url;  \n      } else {\n        location.href = this.login_url;\n      }\n    }\n  }\n}"],"names":[],"mappings":"kPAuBA,KAAM,GAAqD,CACzD,MAAO,oBACP,SAAU,SAAS,IACrB,EAEqB,MAAA,CAAA,CAInB,YAAY,EAAkB,CACrB,EAAA,OAAO,OAAO,EAAe,CAAI,EACnC,KAAA,SAAW,6DAA6D,EAAK,sBAAsB,mBAAmB,EAAK,QAAQ,gDAAgD,EAAK,wBAG7L,AADiB,oBAAoB,KAAK,UAAU,SAAS,EAGtD,KAAA,UAAY,6DAA6D,EAAK,sBAAsB,mBAAmB,EAAK,QAAQ,oDAAoD,EAAK,wBAG7L,KAAA,UAAY,sDAAsD,EAAK,sBAAsB,mBAAmB,EAAK,QAAQ,iDAAiD,EAAK,uBAE5L,CAEA,QAAQ,EAAyB,OAAQ,CACvC,KAAM,GAAO,GAAI,iBAAgB,SAAS,MAAM,EAC1C,EAAO,EAAK,IAAI,MAAM,EAE5B,GADc,EAAK,IAAI,OAAO,EAErB,MAAA,GAEP,AAAI,IAAS,OACX,SAAS,KAAO,KAAK,SAErB,SAAS,KAAO,KAAK,SAG3B,CACF"}