{"version":3,"file":"index.es.js","sources":["../src/index.ts"],"sourcesContent":["/*\n * @Author: zhangyang\n * @Date: 2022-07-02 14:36:13\n * @LastEditTime: 2022-08-05 08:15:16\n * @Description: \n */\ntype AuthConfig = {\n  /**\n   * 微信公众号 appid\n   */\n  appid: string;\n  /**\n   * 微信开放平台-应用 appid，PC 端扫码登录必传\n   */\n  open_appid?: string;\n  /**\n   * state 标志位的内容\n   * @default 'young_wechat_auth'\n   */\n  state?: string;\n  /**\n   * 重定向的地址\n   * @default location.href\n   */\n  redirect?: string;\n};\n\nconst defaultConfig: Omit<Required<AuthConfig>, 'appid' | 'open_appid'> = {\n  state: 'young_wechat_auth',\n  redirect: location.href\n};\n\nexport default class {\n  public auth_url: string;\n  public login_url: string;\n\n  constructor(conf: AuthConfig) {\n    conf = Object.assign(defaultConfig, conf);\n    this.auth_url = `https://open.weixin.qq.com/connect/oauth2/authorize?appid=${conf.appid}&redirect_uri=${encodeURIComponent(conf.redirect)}&response_type=code&scope=snsapi_base&state=${conf.state}#wechat_redirect`;\n    \n    const isWeChat = /MicroMessenger/img.test(navigator.userAgent);\n    if (isWeChat) {\n      // 微信内，执行网页授权\n      this.login_url = `https://open.weixin.qq.com/connect/oauth2/authorize?appid=${conf.appid}&redirect_uri=${encodeURIComponent(conf.redirect)}&response_type=code&scope=snsapi_userinfo&state=${conf.state}#wechat_redirect`;\n    } else {\n      // 微信外，扫码登录\n      this.login_url = `https://open.weixin.qq.com/connect/qrconnect?appid=${conf.open_appid}&redirect_uri=${encodeURIComponent(conf.redirect)}&response_type=code&scope=snsapi_login&state=${conf.state}#wechat_redirect`;\n    }\n  }\n  \n  getCode(type: 'base' | 'login' = 'base') {\n    const args = new URLSearchParams(location.search);\n    const code = args.get('code');\n    const state = args.get('state');\n    if (state) {\n      return code;\n    } else {\n      if (type === 'base') {\n        location.href = this.auth_url;  \n      } else {\n        location.href = this.login_url;\n      }\n    }\n  }\n}"],"names":[],"mappings":"AA2BA,MAAM,gBAAoE;AAAA,EACxE,OAAO;AAAA,EACP,UAAU,SAAS;AACrB;AAEqB,MAAA,MAAA;AAAA,EAInB,YAAY,MAAkB;AACrB,WAAA,OAAO,OAAO,eAAe,IAAI;AACnC,SAAA,WAAW,6DAA6D,KAAK,sBAAsB,mBAAmB,KAAK,QAAQ,gDAAgD,KAAK;AAE7L,UAAM,WAAW,oBAAoB,KAAK,UAAU,SAAS;AAC7D,QAAI,UAAU;AAEP,WAAA,YAAY,6DAA6D,KAAK,sBAAsB,mBAAmB,KAAK,QAAQ,oDAAoD,KAAK;AAAA,IAAA,OAC7L;AAEA,WAAA,YAAY,sDAAsD,KAAK,2BAA2B,mBAAmB,KAAK,QAAQ,iDAAiD,KAAK;AAAA,IAC/L;AAAA,EACF;AAAA,EAEA,QAAQ,OAAyB,QAAQ;AACvC,UAAM,OAAO,IAAI,gBAAgB,SAAS,MAAM;AAC1C,UAAA,OAAO,KAAK,IAAI,MAAM;AACtB,UAAA,QAAQ,KAAK,IAAI,OAAO;AAC9B,QAAI,OAAO;AACF,aAAA;AAAA,IAAA,OACF;AACL,UAAI,SAAS,QAAQ;AACnB,iBAAS,OAAO,KAAK;AAAA,MAAA,OAChB;AACL,iBAAS,OAAO,KAAK;AAAA,MACvB;AAAA,IACF;AAAA,EACF;AACF;;"}