"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});class o{constructor(e){this.config=e,(e.redirectPath===void 0||e.redirectPath===null)&&(this.config.redirectPath="/callback")}getSignupUrl(e=!0){return e?`${this.config.serverUrl.trim()}/signup/${this.config.appName}`:this.getSigninUrl().replace("/login/oauth/authorize","/signup/oauth/authorize")}getSigninUrl(){const e=`${window.location.origin}${this.config.redirectPath}`,t="read",i=this.config.appName;return`${this.config.serverUrl.trim()}/login/oauth/authorize?client_id=${this.config.clientId}&response_type=code&redirect_uri=${encodeURIComponent(e)}&scope=${t}&state=${i}`}getUserProfileUrl(e,t){let i="";return t!=null&&(i=`?access_token=${t.accessToken}`),`${this.config.serverUrl.trim()}/users/${this.config.organizationName}/${e}${i}`}getMyProfileUrl(e){let t="";return e!=null&&(t=`?access_token=${e.accessToken}`),`${this.config.serverUrl.trim()}/account${t}`}signin(e){const t=new URLSearchParams(window.location.search);return fetch(`${e}/api/signin?code=${t.get("code")}&state=${t.get("state")}`,{method:"POST",credentials:"include"}).then(i=>i.json())}}const r="I want to login";class a{constructor(e,t=r){const i=async s=>{s.data.cmd===t&&e.onmsg_cbk(s)};window.addEventListener("message",i)}}class c{constructor(e,t=r){this.cmd=t;const i=async s=>{s.origin===e.master_url&&await e.onmsg_cbk(s.data)};window.addEventListener("message",i)}init(e){window.opener?window.opener.postMessage({cmd:this.cmd},"*"):e==null||e()}}const d={serverUrl:"https://door.casdoor.com",clientId:"014ae4bd048734ca2dea",organizationName:"casbin",appName:"app-casnode",redirectPath:window.location.pathname};class l{static hasAuthed(){const{code:e,state:t}=Object.fromEntries(new URLSearchParams(window.location.search));return!!(e&&t)}constructor(e={}){const t=Object.assign(d,e);this.sdk=new o(t)}init(e="login"){let t="";e==="register"?t=this.sdk.getSignupUrl():t=this.sdk.getSigninUrl(),window.location.href=t}}exports.Master=a;exports.Slave=c;exports.YoungAuth=l;exports.defaultCmd=r;
//# sourceMappingURL=index.cjs.js.map
